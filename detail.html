<!DOCTYPE html>
<html>
    <head>
        <title>活动详情 - 志愿活动管理系统</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/bootstrap-icons.css" rel="stylesheet">
        <link href="css/font-awesome.min.css" rel="stylesheet">
    </head>
    <body>
        <main class="flex-shrink-0 mt-5 mb-5">
            <div class="container" id="body-container">
                <h1></h1>
            </div>
        </main>
        
        <script src="js/jquery-3.3.1.min.js"></script>
        <script src="js/bootstrap.bundle.min.js"></script>
        <script src="//code.bdstatic.com/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
        <script src="js/echarts.min.js"></script>
        <script src="js/main.js"></script>
        <script src="js/time.js"></script>
        <script>
            generateBody((user) => {
                query = new AV.Query('Activity');
                query.get($.getUrlParam("oid")).then((activity) => {
                    $("title").text(`${activity.get("title")} - 活动详情 - 志愿活动管理系统`);
                    $("h1").text(activity.get("title"));
                    $("#body-container").append(`
                        <div class="table-responsive">
                            <table class="table" id="body-table">
                                <tbody>
                                    <tr>
                                        <th scope="row" width="50"><i class="bi bi-people-fill"></i></th>
                                        <td>${activity.get("participantsLimit")}</td>
                                    </tr>
                                    <tr>
                                        <th scope="row"><i class="bi bi-geo-alt-fill"></i></th>
                                        <td>
                                            ${campuses[activity.get("campus")]}
                                            <i class="bi bi-chevron-right"></i>
                                            ${activity.get("site")}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row"><i class="bi bi-clock-fill"></i></th>
                                        <td><div id="time-container" style="width: 480px; height:360px;"></div></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    `);
                    generateTimeChart("time-container", activity);
                    if (activity.get("desc")) {
                        $("#body-table tbody").append(`
                            <tr>
                                <th scope="row"><i class="bi bi-chat-square-text-fill"></i></th>
                                <td>${activity.get("desc")}</td>
                            </tr>
                        `);
                    }
                    // Buttons
                    $("#body-container").append(`
                        <div class="btn-group">
                            <a href="javascript: void();" class="btn btn-outline-success">
                                <i class="bi bi-calendar-plus-fill"></i>
                                加入意愿
                            </a>
                        </div>
                    `);
                    if (user.get("isAdmin")) {
                        $("#body-container").append(`
                            <div class="btn-group">
                                <a href="edit.html?oid=${$.getUrlParam("oid")}" class="btn btn-outline-primary">
                                    <i class="bi bi-pen-fill"></i>
                                    编辑
                                </a>
                            </div>
                        `);
                    }
                }, (error) => {
                    generateErrorAlert(error);
                })
            });
        </script>
    </body>
</html>